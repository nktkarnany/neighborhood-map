function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:model.currentLocation,zoom:15}),getCurrentLocation()}function googleError(){alert("Sorry! Not able to load google maps. Please try again later.")}function getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):(console.log("Geolocation is not supported by this browser."),initModel())}function showPosition(o){model.currentLocation.lat=o.coords.latitude,model.currentLocation.lng=o.coords.longitude,map.setCenter(model.currentLocation),getPlaces()}function getPlaces(){var o={location:model.currentLocation,radius:"500",types:["restaurant"]};new google.maps.places.PlacesService(map).nearbySearch(o,callback)}function callback(o,e){e==google.maps.places.PlacesServiceStatus.OK?(model.places=o,initModel()):alert("Sorry!! No connection. Please try again later")}function initModel(){renderAllMarkers();var o={toggle:ko.observable(!0),toggleMenu:function(){this.toggle(!this.toggle())},placeClicked:function(o){var e=o.marker,n=o.infoWindow;n.isOpen()?(n.close(map,e),e.setAnimation(null)):(n.open(map,e),e.setAnimation(google.maps.Animation.BOUNCE))},query:ko.observable(""),places:ko.pureComputed(function(){var e=o.query().toLowerCase();return ko.utils.arrayFilter(model.places,function(o,n){var t=o.name.toLowerCase().indexOf(e)>=0;return o.marker.setVisible(t),t})})};ko.applyBindings(o)}function renderAllMarkers(){google.maps.InfoWindow.prototype.isOpen=function(){var o=this.getMap();return null!==o&&void 0!==o},model.places.forEach(function(o,e){var n=new google.maps.Marker({position:{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},map:map}),t=new google.maps.InfoWindow({content:o.vicinity});t.addListener("closeclick",function(){t.close(map,n),n.setAnimation(null)}),n.addListener("click",function(){t.isOpen()?(t.close(map,n),n.setAnimation(null)):(t.open(map,n),n.setAnimation(google.maps.Animation.BOUNCE))}),model.places[e].marker=n,model.places[e].infoWindow=t}),updateInfoWindows()}var model={currentLocation:{lat:40.74135,lng:-73.99802},places:[]},map,infoWindows=[],updateInfoWindows=function(){model.places.forEach(function(o,e){var n=model.places[e].infoWindow;$.ajax({url:"http://en.wikipedia.org/w/api.php?action=opensearch&search="+o.name,type:"get",dataType:"jsonp",success:function(o){var e=o[3][0];e?n.setContent("<a href='"+e+'\' target="blank">'+e+"</a>"):n.setContent("No Wiki!!")},error:function(){n.setContent("Sorry!! Lost connection")}})})};
