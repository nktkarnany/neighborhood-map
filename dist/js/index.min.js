function initMap(){setTimeout(function(){window.google&&window.google.maps||alert("Not able to load google maps...Please try again later!!")},5e3),map=new google.maps.Map(document.getElementById("map"),{center:model.currentLocation,zoom:15}),getCurrentLocation()}function getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):(console.log("Geolocation is not supported by this browser."),initModel())}function showPosition(o){model.currentLocation.lat=o.coords.latitude,model.currentLocation.lng=o.coords.longitude,map.setCenter(model.currentLocation),getPlaces()}function getPlaces(){var o={location:model.currentLocation,radius:"500",types:["restaurant"]};new google.maps.places.PlacesService(map).nearbySearch(o,callback)}function callback(o,e){e==google.maps.places.PlacesServiceStatus.OK?(o.forEach(function(e,n){o[n].index=n}),model.places=o,initModel()):alert("Sorry!! No connection. Please try again later")}function initModel(){renderAllMarkers();var o={toggle:ko.observable(!0),toggleMenu:function(){this.toggle(!this.toggle())},showDetail:function(e){var n=o.places()[e].index;markers[n].setAnimation(google.maps.Animation.BOUNCE),infoWindows[n].open(map,markers[n])},hideDetail:function(e){var n=o.places()[e].index;markers[n].setAnimation(null),infoWindows[n].close(map,markers[n])},query:ko.observable(""),places:ko.pureComputed(function(){var e=o.query().toLowerCase();return ko.utils.arrayFilter(model.places,function(o,n){return o.name.toLowerCase().indexOf(e)>=0?(markers[n].setMap(map),!0):(markers[n].setMap(null),!1)})})};ko.applyBindings(o)}function renderAllMarkers(){google.maps.InfoWindow.prototype.isOpen=function(){var o=this.getMap();return null!==o&&void 0!==o},model.places.forEach(function(o,e){var n=new google.maps.Marker({position:{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},map:map}),t=new google.maps.InfoWindow({content:o.name});t.addListener("closeclick",function(){t.close(map,n),n.setAnimation(null)}),infoWindows.push(t),n.addListener("click",function(){t.isOpen()?(t.close(map,n),n.setAnimation(null)):(t.open(map,n),n.setAnimation(google.maps.Animation.BOUNCE))}),markers.push(n)}),updateInfoWindows(infoWindows)}var model={currentLocation:{lat:40.74135,lng:-73.99802},places:[]},map,markers=[],infoWindows=[],updateInfoWindows=function(o){o.forEach(function(o,e){$.ajax({url:"http://en.wikipedia.org/w/api.php?action=opensearch&search="+o.getContent(),type:"get",dataType:"jsonp",success:function(o){var n=o[3][0];n?infoWindows[e].setContent("<a href='"+n+"'>"+n+"</a>"):infoWindows[e].setContent("No Wiki!!")},error:function(){infowindow[e].setContent("Sorry!! Lost connection")}})})};
