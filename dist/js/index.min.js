function initMap(){setTimeout(function(){window.google&&window.google.maps||alert("Not able to load google maps...Please try again later!!")},5e3),map=new google.maps.Map(document.getElementById("map"),{center:model.currentLocation,zoom:15}),getCurrentLocation()}function getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):(console.log("Geolocation is not supported by this browser."),initModel())}function showPosition(o){model.currentLocation.lat=o.coords.latitude,model.currentLocation.lng=o.coords.longitude,map.setCenter(model.currentLocation),getPlaces()}function getPlaces(){var o={location:model.currentLocation,radius:"500",types:["restaurant"]};new google.maps.places.PlacesService(map).nearbySearch(o,callback)}function callback(o,e){e==google.maps.places.PlacesServiceStatus.OK&&(model.places=o,initModel())}function initModel(){renderAllMarkers();var o={toggle:ko.observable(!0),toggleMenu:function(){this.toggle(!this.toggle())},showDetail:function(o){markers[o].setAnimation(google.maps.Animation.BOUNCE)},hideDetail:function(o){markers[o].setAnimation(null)},query:ko.observable(""),places:ko.pureComputed(function(){var e=o.query().toLowerCase();return ko.utils.arrayFilter(model.places,function(o,n){return o.name.toLowerCase().indexOf(e)>=0?(markers[n].setMap(map),!0):(markers[n].setMap(null),!1)})})};ko.applyBindings(o)}function renderAllMarkers(){google.maps.InfoWindow.prototype.isOpen=function(){var o=this.getMap();return null!==o&&void 0!==o},model.places.forEach(function(o){var e=new google.maps.Marker({position:{lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},map:map}),n=new google.maps.InfoWindow({content:o.vicinity});e.addListener("click",function(){n.isOpen()?(n.close(map,e),e.setAnimation(null)):(n.open(map,e),e.setAnimation(google.maps.Animation.BOUNCE))}),n.addListener("closeclick",function(){n.close(map,e),e.setAnimation(null)}),markers.push(e)})}var model={currentPlace:"Chelsea, New York",currentLocation:{lat:40.74135,lng:-73.99802},places:[]},map,markers=[];
